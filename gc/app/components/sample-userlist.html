<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/iron-icons/iron-icons.html"><link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html"></head><body><dom-module id="sample-userlist"><template><style>:host{display:block;}a{color:var(--accent-color);text-decoration:none;}table{width:100%;border-collapse:collapse;}tr.title{font-weight:bold;}tr.title td{height:30px;border-bottom:solid 1px var(--primary-color);}tr.deleted{text-decoration:line-through;}paper-icon-button{color:var(--primary-color);}</style><h2>User list<paper-icon-button id="reloadBtn" icon="refresh" on-tap="_refresh"></paper-icon-button></h2><h4>Click on user UID to edit it</h4><table><tbody><tr class="title"><td>UID</td><td>Lastname</td><td>Firstname</td><td>Age</td><td>&nbsp;</td></tr><template is="dom-repeat" items="{{users}}" sort="_sortByName"><tr class$="{{_userRowClass(item.deleting)}}"><td style="font-family: monospace"><a href="#" on-tap="_selectUser">{{item.user.id}}</a></td><td>{{item.user.lastname}}</td><td>{{item.user.firstname}}</td><td>{{item.user.age}}</td><td style="width: 30px"><paper-icon-button icon="delete" on-tap="_delete" disabled$="{{item.deleting}}"></paper-icon-button></td></tr></template></tbody></table></template><script>var UserListMixin=App.createKaptonMixin(App.graphql,App.USERS_LIST),DelUserMixin=App.createKaptonMixin(App.graphql,App.DEL_USER,{name:"delete"}),UserChangesMixin=App.createKaptonMixin(App.graphql,App.USER_CHANGES,{name:"updates"}),SampleUserlist=function(c){function d(){return babelHelpers.classCallCheck(this,d),babelHelpers.possibleConstructorReturn(this,(d.__proto__||Object.getPrototypeOf(d)).apply(this,arguments))}return babelHelpers.inherits(d,c),babelHelpers.createClass(d,[{key:"_dataChanged",value:function(g){var h=App.apolloClient.readQuery({query:App.USERS_LIST});"DELETED"===g.User.mutation?(h.allUsers=h.allUsers.filter(function(i){return i.id!=g.User.previousValues.id}),App.apolloClient.writeQuery({query:App.USERS_LIST,data:h})):("CREATED"===g.User.mutation||"UPDATED"===g.User.mutation)&&void 0===h.allUsers.find(function(i){return i.id===g.User.node.id})&&(console.log("push"),h.allUsers.push(g.User.node),App.apolloClient.writeQuery({query:App.USERS_LIST,data:h}))}},{key:"_generateUsers",value:function(g){return g.allUsers.map(function(h){return{user:h,deleting:!1}})}},{key:"_sortByName",value:function(g,h){return g.user.lastname.localeCompare(h.user.lastname)}},{key:"_userRowClass",value:function(g){return g?"deleted":""}},{key:"_selectUser",value:function(g){this.dispatchEvent(new CustomEvent("select-user",{detail:{id:g.model.item.user.id}})),g.preventDefault()}},{key:"_refresh",value:function(){this.data&&(this.$.reloadBtn.disabled=!0,this.data.refetch().then(function(){this.$.reloadBtn.disabled=!1,this.dispatchEvent(new CustomEvent("message",{detail:{msg:"Users data reloaded"},composed:!0}))}.bind(this)))}},{key:"_delete",value:function(g){g.model.set("item.deleting",!0);var h=g.model.item.user;this.dispatchEvent(new CustomEvent("user-deleted",{detail:{uid:h.id}})),this.delete({variables:{id:h.id},updateQueries:{usersList:function(j,k){var l=k.mutationResult,m=l.data.deleteUser.id;return Object.assign({},j,{allUsers:j.allUsers.filter(function(n){return n.id!==m})})}}}).then(function(i){this.dispatchEvent(new CustomEvent("message",{detail:{msg:"User \""+i.data.deleteUser.id+"\" removed"},composed:!0}))}.bind(this)).catch(function(){this.dispatchEvent(new CustomEvent("message",{detail:{msg:"User \""+h.id+"\" not found"},composed:!0}))}.bind(this))}}],[{key:"is",get:function(){return"sample-userlist"}},{key:"properties",get:function(){return{data:Object,users:{type:Array,computed:"_generateUsers(data)"},updates:{type:Object,observer:"_dataChanged"}}}}]),d}(UserChangesMixin(UserListMixin(DelUserMixin(Polymer.Element))));customElements.define(SampleUserlist.is,SampleUserlist);</script></dom-module></body></html>