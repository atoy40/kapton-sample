<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../iron-ajax/iron-ajax.html"></head><body><dom-module id="iron-form"><template><style>:host{display:block;}</style><slot id="content"></slot><form id="helper" action$="[[action]]" method$="[[method]]" enctype$="[[enctype]]"></form></template><script>Polymer({is:'iron-form',properties:{allowRedirect:{type:Boolean,value:!1}},attached:function(){this._nodeObserver=Polymer.dom(this.$.content).observeNodes(function(b){for(var c=0;c<b.addedNodes.length;c++)'FORM'===b.addedNodes[c].tagName&&(this._form=b.addedNodes[c],this._init())}.bind(this))},detached:function(){this._nodeObserver&&(Polymer.dom(this.$.content).unobserveNodes(this._nodeObserver),this._nodeObserver=null)},_init:function(){this._form.addEventListener('submit',this.submit.bind(this)),this._form.addEventListener('reset',this.reset.bind(this))},validate:function(){if(''===this._form.getAttribute('novalidate'))return!0;for(var d,f,b=this._form.checkValidity(),c=this._getValidatableElements(),e=0;d=c[e],e<c.length;e++)f=d,f.validate&&(b=!!f.validate()&&b);return b},submit:function(b){if(b&&b.preventDefault(),!!this.validate()){for(;0!==this.$.helper.children.length;)this.$.helper.removeChild(this.$.helper.children[0]);var c=this.serializeForm();if(this.allowRedirect){for(element in c)this.$.helper.appendChild(this._createHiddenElement(element,c[element]));this.$.helper.submit(),this.fire('iron-form-submit')}else this._makeAjaxRequest(c)}},reset:function(b){b&&b.preventDefault();for(var c=Polymer.dom(this._form).querySelectorAll('*'),d=0;d<c.length;d++)c[d].defaultValue&&(c[d].value=c[d].defaultValue)},serializeForm:function(){for(var e,b=this._getSubmittableElements(),c={},d=0;d<b.length;d++){e=this._serializeElementValues(b[d]);for(var f=0;f<e.length;f++)this._addSerializedElement(c,b[d].name,e[f])}return c},_handleFormResponse:function(b){this.fire('iron-form-response',b.detail)},_handleFormError:function(b){this.fire('iron-form-error',b.detail)},_makeAjaxRequest:function(b){this.ajax||(this.ajax=document.createElement('iron-ajax'),this.ajax.addEventListener('response',this._handleFormResponse.bind(this)),this.ajax.addEventListener('error',this._handleFormError.bind(this))),this.ajax.url=this._form.getAttribute('action'),this.ajax.method=this._form.getAttribute('method'),this.ajax.contentType=this._form.contentType,'POST'===this._form.method.toUpperCase()?this.ajax.body=b:this.ajax.params=b;var c=this.fire('iron-form-presubmit',{},{cancelable:!0});c.defaultPrevented||(this.ajax.generateRequest(),this.fire('iron-form-submit',b))},_getValidatableElements:function(){for(var e,b=Polymer.dom(this._form).querySelectorAll('*'),c=[],d=0;d<b.length;d++){e=Array.prototype.slice.call(Polymer.dom(b[d]).querySelectorAll('*'))||[],e.push(b[d]);for(var f,g=0;f=e[g],g<e.length;g++)f.disabled||c.push(f)}return c},_getSubmittableElements:function(){for(var e,b=Polymer.dom(this._form).querySelectorAll('*'),c=[],d=0;d<b.length;d++){e=Array.prototype.slice.call(Polymer.dom(b[d]).querySelectorAll('*'))||[],e.push(b[d]);for(var f,g=0;f=e[g],g<e.length;g++)!f.disabled&&f.name&&c.push(f)}return c},_serializeElementValues:function(b){var c=b.tagName.toLowerCase();return'button'===c||'input'===c&&('submit'===b.type||'reset'===b.type)?[]:'select'===c?this._serializeSelectValues(b):'input'===c?this._serializeInputValues(b):b._hasIronCheckedElementBehavior&&!b.checked?[]:[b.value]},_serializeSelectValues:function(b){for(var c=[],d=0;d<b.options.length;d++)b.options[d].selected&&c.push(b.options[d].value);return c},_serializeInputValues:function(b){var c=b.type.toLowerCase();return('checkbox'!==c&&'radio'!==c||b.checked)&&'file'!==c?[b.value]:[]},_createHiddenElement:function(b,c){var d=document.createElement('input');return d.setAttribute('type','hidden'),d.setAttribute('name',b),d.setAttribute('value',c),d},_addSerializedElement:function(b,c,d){b[c]?(!Array.isArray(b[c])&&(b[c]=[b[c]]),b[c].push(d)):b[c]=d}});</script></dom-module></body></html>