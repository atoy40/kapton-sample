<html><head><link rel="import" href="../../polymer-element.html"><link rel="import" href="../utils/templatize.html"><link rel="import" href="../utils/debounce.html"><link rel="import" href="../utils/flush.html"><link rel="import" href="../mixins/mutable-data.html"><script>var _get=function c(d,e,f){null===d&&(d=Function.prototype);var g=Object.getOwnPropertyDescriptor(d,e);if(g===void 0){var h=Object.getPrototypeOf(d);return null===h?void 0:c(h,e,f)}if("value"in g)return g.value;var j=g.get;return void 0===j?void 0:j.call(f)},_createClass=function(){function c(d,e){for(var g,f=0;f<e.length;f++)g=e[f],g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(d,g.key,g)}return function(d,e,f){return e&&c(d.prototype,e),f&&c(d,f),d}}();function _classCallCheck(c,d){if(!(c instanceof d))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(c,d){if(!c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d&&("object"==typeof d||"function"==typeof d)?d:c}function _inherits(c,d){if("function"!=typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function, not "+typeof d);c.prototype=Object.create(d&&d.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),d&&(Object.setPrototypeOf?Object.setPrototypeOf(c,d):c.__proto__=d)}(function(){"use strict";var c=Polymer.OptionalMutableData(Polymer.Element),d=function(e){function f(){_classCallCheck(this,f);var g=_possibleConstructorReturn(this,(f.__proto__||Object.getPrototypeOf(f)).call(this));return g.__instances=[],g.__limit=Infinity,g.__pool=[],g.__renderDebouncer=null,g.__itemsIdxToInstIdx={},g.__chunkCount=null,g.__lastChunkTime=null,g.__needFullRefresh=!1,g.__sortFn=null,g.__filterFn=null,g.__observePaths=null,g.__ctor=null,g}return _inherits(f,e),_createClass(f,null,[{key:"is",get:function(){return"dom-repeat"}},{key:"template",get:function(){return null}},{key:"properties",get:function(){return{items:{type:Array},as:{type:String,value:"item"},indexAs:{type:String,value:"index"},itemsIndexAs:{type:String,value:"itemsIndex"},sort:{type:Function,observer:"__sortChanged"},filter:{type:Function,observer:"__filterChanged"},observe:{type:String,observer:"__observeChanged"},delay:Number,renderedItemCount:{type:Number,notify:!0,readOnly:!0},initialCount:{type:Number,observer:"__initializeChunking"},targetFramerate:{type:Number,value:20},_targetFrameTime:{type:Number,computed:"__computeFrameTime(targetFramerate)"}}}},{key:"observers",get:function(){return["__itemsChanged(items.*)"]}}]),_createClass(f,[{key:"disconnectedCallback",value:function(){_get(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"disconnectedCallback",this).call(this),this.__isDetached=!0;for(var h=0;h<this.__instances.length;h++)this.__detachInstance(h)}},{key:"connectedCallback",value:function(){if(_get(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"connectedCallback",this).call(this),this.__isDetached){this.__isDetached=!1;for(var h=this.parentNode,j=0;j<this.__instances.length;j++)this.__attachInstance(j,h)}}},{key:"__ensureTemplatized",value:function(){var h=this;if(!this.__ctor){var j=this.template=this.querySelector("template");if(!j){var k=new MutationObserver(function(){if(h.querySelector("template"))k.disconnect(),h.__render();else throw new Error("dom-repeat requires a <template> child")});return k.observe(this,{childList:!0}),!1}var l={};l[this.as]=!0,l[this.indexAs]=!0,l[this.itemsIndexAs]=!0,this.__ctor=Polymer.Templatize.templatize(j,this,{mutableData:this.mutableData,parentModel:!0,instanceProps:l,forwardHostProp:function(n,o){for(var r,p=this.__instances,q=0;q<p.length&&(r=p[q]);q++)r.forwardHostProp(n,o)},notifyInstanceProp:function(n,o,p){if(Polymer.Path.matches(this.as,o)){var q=n[this.itemsIndexAs];o==this.as&&(this.items[q]=p);var r=Polymer.Path.translate(this.as,"items."+q,o);this.notifyPath(r,p)}}})}return!0}},{key:"__getMethodHost",value:function(){return this.__dataHost._methodHost||this.__dataHost}},{key:"__sortChanged",value:function(h){var j=this.__getMethodHost();this.__sortFn=h&&("function"==typeof h?h:function(){return j[h].apply(j,arguments)}),this.__needFullRefresh=!0,this.items&&this.__debounceRender(this.__render)}},{key:"__filterChanged",value:function(h){var j=this.__getMethodHost();this.__filterFn=h&&("function"==typeof h?h:function(){return j[h].apply(j,arguments)}),this.__needFullRefresh=!0,this.items&&this.__debounceRender(this.__render)}},{key:"__computeFrameTime",value:function(h){return Math.ceil(1e3/h)}},{key:"__initializeChunking",value:function(){this.initialCount&&(this.__limit=this.initialCount,this.__chunkCount=this.initialCount,this.__lastChunkTime=performance.now())}},{key:"__tryRenderChunk",value:function(){this.items&&this.__limit<this.items.length&&this.__debounceRender(this.__requestRenderChunk)}},{key:"__requestRenderChunk",value:function(){var h=this;requestAnimationFrame(function(){return h.__renderChunk()})}},{key:"__renderChunk",value:function(){var h=performance.now(),j=this._targetFrameTime/(h-this.__lastChunkTime);this.__chunkCount=Math.round(this.__chunkCount*j)||1,this.__limit+=this.__chunkCount,this.__lastChunkTime=h,this.__debounceRender(this.__render)}},{key:"__observeChanged",value:function(){this.__observePaths=this.observe&&this.observe.replace(".*",".").split(" ")}},{key:"__itemsChanged",value:function(h){this.items&&!Array.isArray(this.items)&&console.warn("dom-repeat expected array for `items`, found",this.items),this.__handleItemPath(h.path,h.value)||(this.__needFullRefresh=!0,this.__initializeChunking(),this.__debounceRender(this.__render))}},{key:"__handleObservedPaths",value:function(h){if(this.__observePaths){h=h.substring(h.indexOf(".")+1);for(var j=this.__observePaths,k=0;k<j.length;k++)if(0===h.indexOf(j[k]))return this.__needFullRefresh=!0,this.__debounceRender(this.__render,this.delay),!0}}},{key:"__debounceRender",value:function(h,j){this.__renderDebouncer=Polymer.Debouncer.debounce(this.__renderDebouncer,0<j?Polymer.Async.timeOut.after(j):Polymer.Async.microTask,h.bind(this)),Polymer.enqueueDebouncer(this.__renderDebouncer)}},{key:"render",value:function(){this.__needFullRefresh=!0,this.__debounceRender(this.__render),Polymer.flush()}},{key:"__render",value:function(){this.__ensureTemplatized()&&(this.__applyFullRefresh(),this.__pool.length=0,this._setRenderedItemCount(this.__instances.length),this.dispatchEvent(new CustomEvent("dom-change",{bubbles:!0,composed:!0})),this.__tryRenderChunk())}},{key:"__applyFullRefresh",value:function(){for(var h=this,j=this.items||[],k=Array(j.length),l=0;l<j.length;l++)k[l]=l;this.__filterFn&&(k=k.filter(function(t,u,v){return h.__filterFn(j[t],u,v)})),this.__sortFn&&k.sort(function(t,u){return h.__sortFn(j[t],j[u])});for(var m=this.__itemsIdxToInstIdx={},n=0,o=Math.min(k.length,this.__limit);n<o;n++){var p=this.__instances[n],q=k[n],r=j[q];m[q]=n,p&&n<this.__limit?(p._setPendingProperty(this.as,r),p._setPendingProperty(this.indexAs,n),p._setPendingProperty(this.itemsIndexAs,q),p._flushProperties()):this.__insertInstance(r,n,q)}for(var s=this.__instances.length-1;s>=n;s--)this.__detachAndRemoveInstance(s)}},{key:"__detachInstance",value:function(h){for(var l,j=this.__instances[h],k=0;k<j.children.length;k++)l=j.children[k],j.root.appendChild(l);return j}},{key:"__attachInstance",value:function(h,j){var k=this.__instances[h];j.insertBefore(k.root,this)}},{key:"__detachAndRemoveInstance",value:function(h){var j=this.__detachInstance(h);j&&this.__pool.push(j),this.__instances.splice(h,1)}},{key:"__stampInstance",value:function(h,j,k){var l={};return l[this.as]=h,l[this.indexAs]=j,l[this.itemsIndexAs]=k,new this.__ctor(l)}},{key:"__insertInstance",value:function(h,j,k){var l=this.__pool.pop();l?(l._setPendingProperty(this.as,h),l._setPendingProperty(this.indexAs,j),l._setPendingProperty(this.itemsIndexAs,k),l._flushProperties()):l=this.__stampInstance(h,j,k);var m=this.__instances[j+1],n=m?m.children[0]:this;return this.parentNode.insertBefore(l.root,n),this.__instances[j]=l,l}},{key:"_showHideChildren",value:function(h){for(var j=0;j<this.__instances.length;j++)this.__instances[j]._showHideChildren(h)}},{key:"__handleItemPath",value:function(h,j){var k=h.slice(6),l=k.indexOf("."),m=0>l?k:k.substring(0,l);if(m==parseInt(m,10)){var n=0>l?"":k.substring(l+1);if(!this.__handleObservedPaths(n)){var o=this.__itemsIdxToInstIdx[m],p=this.__instances[o];if(p){var q=this.as+(n?"."+n:"");p._setPendingPropertyOrPath(q,j,!1,!0),p._flushProperties()}}return!0}}},{key:"itemForElement",value:function(h){var j=this.modelForElement(h);return j&&j[this.as]}},{key:"indexForElement",value:function(h){var j=this.modelForElement(h);return j&&j[this.indexAs]}},{key:"modelForElement",value:function(h){return Polymer.Templatize.modelForElement(this.template,h)}}]),f}(c);customElements.define(d.is,d),Polymer.DomRepeat=d})();</script></head><body></body></html>