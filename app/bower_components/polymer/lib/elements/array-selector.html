<html><head><link rel="import" href="../../polymer-element.html"><link rel="import" href="../utils/mixin.html"><link rel="import" href="../utils/array-splice.html"><script>var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b&&("object"==typeof b||"function"==typeof b)?b:a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}(function(){"use strict";var a=Polymer.dedupingMixin(function(d){var e=function(f){function g(){_classCallCheck(this,g);var h=_possibleConstructorReturn(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));return h.__lastItems=null,h.__lastMulti=null,h.__selectedMap=null,h}return _inherits(g,f),_createClass(g,null,[{key:"properties",get:function(){return{items:{type:Array},multi:{type:Boolean,value:!1},selected:{type:Object,notify:!0},selectedItem:{type:Object,notify:!0},toggle:{type:Boolean,value:!1}}}},{key:"observers",get:function(){return["__updateSelection(multi, items.*)"]}}]),_createClass(g,[{key:"__updateSelection",value:function(k,l){var m=l.path;if("items"==m){var n=l.base||[],o=this.__lastItems,p=this.__lastMulti;if(k!==p&&this.clearSelection(),o){var q=Polymer.ArraySplice.calculateSplices(n,o);this.__applySplices(q)}this.__lastItems=n,this.__lastMulti=k}else if("items.splices"==l.path)this.__applySplices(l.value.indexSplices);else{var r=m.slice("items.".length),t=parseInt(r,10);0>r.indexOf(".")&&r==t&&this.__deselectChangedIdx(t)}}},{key:"__applySplices",value:function(k){for(var l=this,m=this.__selectedMap,n=function(r){var t=k[r];m.forEach(function(w,x){w<t.index||(w>=t.index+t.removed.length?m.set(x,w+t.addedCount-t.removed.length):m.set(x,-1))});for(var v,u=0;u<t.addedCount;u++)v=t.index+u,m.has(l.items[v])&&m.set(l.items[v],v)},o=0;o<k.length;o++)n(o);this.__updateLinks();var p=0;m.forEach(function(q,r){0>q?(l.multi?l.splice("selected",p,1):l.selected=l.selectedItem=null,m.delete(r)):p++})}},{key:"__updateLinks",value:function(){var k=this;if(this.__dataLinkedPaths={},this.multi){var l=0;this.__selectedMap.forEach(function(m){0<=m&&k.linkPaths("items."+m,"selected."+l++)})}else this.__selectedMap.forEach(function(m){k.linkPaths("selected","items."+m),k.linkPaths("selectedItem","items."+m)})}},{key:"clearSelection",value:function(){this.__dataLinkedPaths={},this.__selectedMap=new Map,this.selected=this.multi?[]:null,this.selectedItem=null}},{key:"isSelected",value:function(k){return this.__selectedMap.has(k)}},{key:"isIndexSelected",value:function(k){return this.isSelected(this.items[k])}},{key:"__deselectChangedIdx",value:function(k){var l=this,m=this.__selectedIndexForItemIndex(k);if(0<=m){var n=0;this.__selectedMap.forEach(function(o,p){m==n++&&l.deselect(p)})}}},{key:"__selectedIndexForItemIndex",value:function(k){var l=this.__dataLinkedPaths["items."+k];if(l)return parseInt(l.slice("selected.".length),10)}},{key:"deselect",value:function(k){var l=this.__selectedMap.get(k);if(0<=l){this.__selectedMap.delete(k);var m;this.multi&&(m=this.__selectedIndexForItemIndex(l)),this.__updateLinks(),this.multi?this.splice("selected",m,1):this.selected=this.selectedItem=null}}},{key:"deselectIndex",value:function(k){this.deselect(this.items[k])}},{key:"select",value:function(k){this.selectIndex(this.items.indexOf(k))}},{key:"selectIndex",value:function(k){var l=this.items[k];this.isSelected(l)?this.toggle&&this.deselectIndex(k):(!this.multi&&this.__selectedMap.clear(),this.__selectedMap.set(l,k),this.__updateLinks(),this.multi?this.push("selected",l):this.selected=this.selectedItem=l)}}]),g}(d);return e});Polymer.ArraySelectorMixin=a;var b=a(Polymer.Element),c=function(d){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,d),_createClass(e,null,[{key:"is",get:function(){return"array-selector"}}]),e}(b);customElements.define(c.is,c),Polymer.ArraySelector=c})();</script></head><body></body></html>