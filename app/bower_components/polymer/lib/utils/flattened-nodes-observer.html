<html><head><link rel="import" href="../utils/boot.html"><link rel="import" href="../utils/array-splice.html"><link rel="import" href="../utils/async.html"><script>var _createClass=function(){function c(d,e){for(var g,f=0;f<e.length;f++)g=e[f],g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(d,g.key,g)}return function(d,e,f){return e&&c(d.prototype,e),f&&c(d,f),d}}();function _classCallCheck(c,d){if(!(c instanceof d))throw new TypeError("Cannot call a class as a function")}(function(){"use strict";function c(e){return"slot"===e.localName}var d=function(){function e(f,g){var h=this;_classCallCheck(this,e),this._shadyChildrenObserver=null,this._nativeChildrenObserver=null,this._connected=!1,this._target=f,this.callback=g,this._effectiveNodes=[],this._observer=null,this._scheduled=!1,this._boundSchedule=function(){h._schedule()},this.connect(),this._schedule()}return _createClass(e,null,[{key:"getFlattenedNodes",value:function(g){return c(g)?g.assignedNodes({flatten:!0}):Array.from(g.childNodes).map(function(h){return c(h)?h.assignedNodes({flatten:!0}):[h]}).reduce(function(h,k){return h.concat(k)},[])}}]),_createClass(e,[{key:"connect",value:function(){var g=this;c(this._target)?this._listenSlots([this._target]):(this._listenSlots(this._target.children),window.ShadyDOM?this._shadyChildrenObserver=ShadyDOM.observeChildren(this._target,function(h){g._processMutations(h)}):(this._nativeChildrenObserver=new MutationObserver(function(h){g._processMutations(h)}),this._nativeChildrenObserver.observe(this._target,{childList:!0}))),this._connected=!0}},{key:"disconnect",value:function(){c(this._target)?this._unlistenSlots([this._target]):(this._unlistenSlots(this._target.children),window.ShadyDOM&&this._shadyChildrenObserver?(ShadyDOM.unobserveChildren(this._shadyChildrenObserver),this._shadyChildrenObserver=null):this._nativeChildrenObserver&&(this._nativeChildrenObserver.disconnect(),this._nativeChildrenObserver=null)),this._connected=!1}},{key:"_schedule",value:function(){var g=this;this._scheduled||(this._scheduled=!0,Polymer.Async.microTask.run(function(){return g.flush()}))}},{key:"_processMutations",value:function(g){this._processSlotMutations(g),this.flush()}},{key:"_processSlotMutations",value:function(g){if(g)for(var k,h=0;h<g.length;h++)k=g[h],k.addedNodes&&this._listenSlots(k.addedNodes),k.removedNodes&&this._unlistenSlots(k.removedNodes)}},{key:"flush",value:function(){if(this._connected){window.ShadyDOM&&ShadyDOM.flush(),this._nativeChildrenObserver?this._processSlotMutations(this._nativeChildrenObserver.takeRecords()):this.shadyChildrenObserver&&this._processSlotMutations(this._shadyChildrenObserver.takeRecords()),this._scheduled=!1;for(var m,g={target:this._target,addedNodes:[],removedNodes:[]},h=this.constructor.getFlattenedNodes(this._target),k=Polymer.ArraySplice.calculateSplices(h,this._effectiveNodes),l=0;l<k.length&&(m=k[l]);l++)for(var p,o=0;o<m.removed.length&&(p=m.removed[o]);o++)g.removedNodes.push(p);for(var r,q=0;q<k.length&&(r=k[q]);q++)for(var t=r.index;t<r.index+r.addedCount;t++)g.addedNodes.push(h[t]);this._effectiveNodes=h;var u=!1;return(g.addedNodes.length||g.removedNodes.length)&&(u=!0,this.callback.call(this._target,g)),u}}},{key:"_listenSlots",value:function(g){for(var k,h=0;h<g.length;h++)k=g[h],c(k)&&k.addEventListener("slotchange",this._boundSchedule)}},{key:"_unlistenSlots",value:function(g){for(var k,h=0;h<g.length;h++)k=g[h],c(k)&&k.removeEventListener("slotchange",this._boundSchedule)}}]),e}();Polymer.FlattenedNodesObserver=d})();</script></head><body></body></html>