<html><head><link rel="import" href="../bower_components/polymer/polymer-element.html"><link rel="import" href="../bower_components/iron-icons/iron-icons.html"><link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html"></head><body><dom-module id="sample-userlist"><template><style>:host{display:block;}a{color:var(--accent-color);text-decoration:none;}table{width:100%;border-collapse:collapse;}tr.title{font-weight:bold;}tr.title td{height:30px;border-bottom:solid 1px var(--primary-color);}tr.deleted{text-decoration:line-through;}paper-icon-button{color:var(--primary-color);}</style><h2>User list<paper-icon-button id="reloadBtn" icon="refresh" on-tap="_refresh"></paper-icon-button></h2><h4>Click on user UID to edit it</h4><table><tbody><tr class="title"><td>UID</td><td>Lastname</td><td>Firstname</td><td>Age</td><td>&nbsp;</td></tr><template is="dom-repeat" items="{{users}}" sort="_sortByName"><tr class$="{{_userRowClass(item.deleting)}}"><td style="font-family: monospace"><a href="#" on-tap="_selectUser">{{item.user.uid}}</a></td><td>{{item.user.lastname}}</td><td>{{item.user.firstname}}</td><td>{{item.user.age}}</td><td style="width: 30px"><paper-icon-button icon="delete" on-tap="_delete" disabled$="{{item.deleting}}"></paper-icon-button></td></tr></template></tbody></table></template><script>var _createClass=function(){function c(d,f){for(var h,g=0;g<f.length;g++)h=f[g],h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(d,h.key,h)}return function(d,f,g){return f&&c(d.prototype,f),g&&c(d,g),d}}();function _classCallCheck(c,d){if(!(c instanceof d))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(c,d){if(!c)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return d&&("object"==typeof d||"function"==typeof d)?d:c}function _inherits(c,d){if("function"!=typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function, not "+typeof d);c.prototype=Object.create(d&&d.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),d&&(Object.setPrototypeOf?Object.setPrototypeOf(c,d):c.__proto__=d)}var UserListMixin=App.createKaptonMixin(App.graphql,App.USERS_LIST),DelUserMixin=App.createKaptonMixin(App.graphql,App.DEL_USER,{name:"delete"}),SampleUserlist=function(c){function d(){return _classCallCheck(this,d),_possibleConstructorReturn(this,(d.__proto__||Object.getPrototypeOf(d)).apply(this,arguments))}return _inherits(d,c),_createClass(d,[{key:"_generateUsers",value:function(g){return g.users.map(function(h){return{user:h,deleting:!1}})}},{key:"_sortByName",value:function(g,h){return g.user.lastname.localeCompare(h.user.lastname)}},{key:"_userRowClass",value:function(g){return g?"deleted":""}},{key:"_selectUser",value:function(g){this.dispatchEvent(new CustomEvent("select-user",{detail:{uid:g.model.item.user.uid}})),g.preventDefault()}},{key:"_refresh",value:function(){this.data&&(this.$.reloadBtn.disabled=!0,this.data.refetch().then(function(){this.$.reloadBtn.disabled=!1,this.dispatchEvent(new CustomEvent("message",{detail:{msg:"Users data reloaded"},composed:!0}))}.bind(this)))}},{key:"_delete",value:function(g){g.model.set("item.deleting",!0);var h=g.model.item.user;this.dispatchEvent(new CustomEvent("user-deleted",{detail:{uid:h.uid}})),this.delete({variables:{uid:h.uid},updateQueries:{usersList:function(k,l){var m=l.mutationResult,n=m.data.delUser.uid;return Object.assign({},k,{users:k.users.filter(function(o){return o.uid!==n})})}}}).then(function(j){this.dispatchEvent(new CustomEvent("message",{detail:{msg:"User \""+j.data.delUser.uid+"\" removed"},composed:!0}))}.bind(this)).catch(function(){this.dispatchEvent(new CustomEvent("message",{detail:{msg:"User \""+h.uid+"\" not found"},composed:!0}))}.bind(this))}}],[{key:"is",get:function(){return"sample-userlist"}},{key:"properties",get:function(){return{data:Object,users:{type:Array,computed:"_generateUsers(data)"}}}}]),d}(UserListMixin(DelUserMixin(Polymer.Element)));customElements.define(SampleUserlist.is,SampleUserlist);</script></dom-module></body></html>